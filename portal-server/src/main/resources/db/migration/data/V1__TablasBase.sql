
-- DATA_TYPE: FLOAT, INT, UINT, STRING, BOOLEAN

CREATE TABLE PARAMETERS (
    TYPE VARCHAR(128) NOT NULL,
    NAME VARCHAR(128) NOT NULL,
    DATA_TYPE VARCHAR(6) NOT NULL,
    VALUE VARCHAR(256) DEFAULT NULL,
    DEFAULT_VALUE VARCHAR(256) DEFAULT NULL,
    DESCRIPTION VARCHAR(2048) DEFAULT NULL,

    PRIMARY KEY(TYPE, NAME)
);

-- STATUS: READY, SUSPENDED, DELETED

CREATE TABLE USERS (
    ID INT UNSIGNED NOT NULL AUTO_INCREMENT,
    USERNAME VARCHAR(64) NOT NULL,
    PASSWORD VARCHAR(512) NOT NULL,
    RESET_PASSWORD BOOLEAN DEFAULT TRUE,
    EMAIL VARCHAR(128) NOT NULL,
    STATUS VARCHAR(32) NOT NULL,

    PRIMARY KEY (ID),
    UNIQUE KEY (USERNAME),
    UNIQUE KEY (EMAIL)
);

CREATE TABLE FUNCTION_TAGS (
    FTAG VARCHAR(256) NOT NULL,
    PRIMARY KEY (FTAG)
);

CREATE TABLE ROLES (
    ID INT UNSIGNED NOT NULL AUTO_INCREMENT,
    ROL VARCHAR(256) NOT NULL,
    PRIMARY KEY (ID),
    UNIQUE KEY (ROL)
);

CREATE TABLE ROL_FTAGS (
    ROL_ID INT UNSIGNED NOT NULL,
    FTAG VARCHAR(256) NOT NULL,

    PRIMARY KEY (ROL_ID, FTAG),
    CONSTRAINT ROL_FTAGS_ID FOREIGN KEY (ROL_ID) REFERENCES ROLES (ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT ROL_FTAGS_FTAG FOREIGN KEY (FTAG) REFERENCES FUNCTION_TAGS (FTAG) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE USER_ROLES (
    USER_ID INT UNSIGNED NOT NULL,
    ROL_ID INT UNSIGNED NOT NULL,

    PRIMARY KEY(USER_ID, ROL_ID),
    CONSTRAINT USER_ROLES_UID FOREIGN KEY (USER_ID) REFERENCES USERS (ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT USER_ROLES_RID FOREIGN KEY (ROL_ID) REFERENCES ROLES (ID) ON DELETE RESTRICT ON UPDATE CASCADE
);